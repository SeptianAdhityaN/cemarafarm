  datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
  }

  generator client {
    provider = "prisma-client-js"
  }

  // --- AUTHENTICATION MODELS (NextAuth Standard) ---
  model Account {
    id                 String  @id @default(cuid())
    userId             String
    type               String
    provider           String
    providerAccountId  String
    refresh_token      String? @db.Text
    access_token       String? @db.Text
    expires_at         Int?
    token_type         String?
    scope              String?
    id_token           String? @db.Text
    session_state      String?

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
  }

  model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  }

  model User {
    id            String    @id @default(cuid())
    name          String?
    email         String?   @unique
    emailVerified DateTime?
    image         String?
    password      String? 
    role          Role      @default(USER)
    accounts      Account[]
    sessions      Session[]
    createdAt     DateTime  @default(now())

    logs ActivityLog[]
  }

  enum Role {
    ADMIN
    STAFF
    USER
  }

  // --- MASTER DATA (Dynamic Tables) ---
  model Variety {
    id          String            @id @default(cuid())
    name        String            @unique
    description String?
    
    price       Decimal  @default(0) @db.Decimal(10, 2)
    imageUrl    String?  // Untuk menyimpan path/URL gambar
    category    String?  @default("Sayuran")

    isArchived  Boolean           @default(false)
    batches     ProductionBatch[]
  }

  model SalesChannel {
    id             String          @id @default(cuid())
    name           String          @unique
    isArchived     Boolean         @default(false)
    sales          Sale[]
  }

  // --- CORE BUSINESS LOGIC ---
  model ProductionBatch {
    id                   String          @id @default(cuid())
    batchCode            String          @unique
    varietyId            String
    variety              Variety         @relation(fields: [varietyId], references: [id])
    sowingDate           DateTime
    estimatedHarvestDate DateTime
    
    initialSeeds         Int             @default(0)
    actualHarvestDate    DateTime?       
    
    currentStockKg       Float           @default(0)
    status               BatchStatus     @default(SEEDING)
    sales                Sale[]

    isArchived           Boolean         @default(false)
    createdAt            DateTime        @default(now())
  }

  model Sale {
    id             String          @id @default(cuid())
    batchId        String
    batch          ProductionBatch @relation(fields: [batchId], references: [id])
    channelId      String
    channel        SalesChannel    @relation(fields: [channelId], references: [id])
    customerName   String
    quantityKg     Float
    
    unitPrice      Decimal         @db.Decimal(12, 2)
    totalPrice     Decimal         @db.Decimal(12, 2)
    
    paymentStatus  PaymentStatus   @default(UNPAID)
    createdAt      DateTime        @default(now())
  }

  enum BatchStatus {
    SEEDING
    GROWING
    READY_TO_HARVEST
    COMPLETED
    FAILED
  }

  enum PaymentStatus {
    PAID
    UNPAID
    CANCELLED
  }

  model ActivityLog {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  action    String 
  details   String
  createdAt DateTime @default(now())

  @@index([userId])
}